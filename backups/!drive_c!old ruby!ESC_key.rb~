  #------------------------------
require 'Win32API'

$DEBUG = TRUE

@@kbhit = Win32API.new("msvcrt", "_kbhit", [], 'I')
@@getch = Win32API.new("msvcrt", "_getch", [], 'I')

def capture_key
	unless @@kbhit.call.zero?
		yield @@getch.call
	end
end

KEY_Esc = 27
$stdout.sync=true

i=0
loop do
	capture_key do |key|
		puts "keypressed: value #{key}, char #{key.chr}" if $DEBUG
		if key == KEY_Esc          
			puts "Escaping key pressed. Exiting..." if $DEBUG
			exit
		end
	end
	sleep 1  #delay it since it's too fast :)
	puts "#{i+=1}"
end
#------------------------------

     #~ 1  #------------------------------
     #~ 2  require 'Win32API'
     #~ 3
     #~ 4  @@kbhit = Win32API.new("msvcrt", "_kbhit", [], 'I')
     #~ 5  @@getch = Win32API.new("msvcrt", "_getch", [], 'I')
     #~ 6
     #~ 7  def capture_key
     #~ 8     unless @@kbhit.call.zero?
     #~ 9        yield @@getch.call
    #~ 10     end
    #~ 11  end
    #~ 12
    #~ 13  KEY_Esc = 27
    #~ 14  $stdout.sync=true
    #~ 15
    #~ 16  i=0
    #~ 17  loop do
    #~ 18     capture_key do |key|
    #~ 19        puts "keypressed: value #{key}, char #{key.chr}" if $DEBUG
    #~ 20        if key == KEY_Esc
    #~ 21           puts "Escaping key pressed. Exiting..." if $DEBUG
    #~ 22           exit
    #~ 23        end
    #~ 24     end
    #~ 25     sleep 1  #delay it since it's too fast :)
    #~ 26     puts "#{i+=1}"
    #~ 27  end
    #~ 28  #------------------------------
